<!-- ==================== SHEET HEADER ==================== -->
<div class="sheet-header">
    <div class="logo-container">
        <img src="https://raw.githubusercontent.com/TheRealDemmy/DnD5e-2024JeansEdition/main/images/DnD2024.jpg" class="sheet-logo">
    </div>

    <div class="name-container">
        <label class="name-label">Character Name</label>
        <input type="text" name="attr_characterName" class="char-name" />
    </div>
</div>

<!-- ==================== GLOBAL STATE ==================== -->
<input type="hidden" name="attr_current_page" value="core" />
<input type="hidden" name="attr_adv_state" value="none" />
<input type="hidden" name="attr_check_roll" value="1d20" />

<!-- ==================== PAGE SELECTOR ==================== -->
<div class="pageSelector">
    <button type="action" name="act_core">Core</button>
    <button type="action" name="act_combat">Combat</button>
    <button type="action" name="act_inventory">Inventory</button>
    <button type="action" name="act_spells">Spells</button>
    <button type="action" name="act_bio">Bio</button>
</div>

<div class="page-divider"></div>

<!-- ==================== MAIN SHEET LAYOUT ==================== -->
<div class="sheet-main">

    <!-- ==================== LEFT COLUMN (40%) ==================== -->
    <div class="sheet-left">

        <!-- ===== STATIC LEFT TOP ===== -->
        <div class="static-left-top">
            <div class="ability-grid">

                <!-- STR -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_StrCheck"
                            value="/roll @{check_roll} + @{str_mod}">
                        STR
                    </button>
                    <div class="ability-score">
                        <span name="attr_str_mod_display"></span>
                    </div>
                    <input type="number" name="attr_str_score" class="ability-score-input" />
                </div>

                <!-- DEX -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_DexCheck"
                            value="/roll @{check_roll} + @{dex_mod}">
                        DEX
                    </button>
                    <div class="ability-score">
                        <span name="attr_dex_mod_display"></span>
                    </div>
                    <input type="number" name="attr_dex_score" class="ability-score-input" />
                </div>

                <!-- CON -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_ConCheck"
                            value="/roll @{check_roll} + @{con_mod}">
                        CON
                    </button>
                    <div class="ability-score">
                        <span name="attr_con_mod_display"></span>
                    </div>
                    <input type="number" name="attr_con_score" class="ability-score-input" />
                </div>

                <!-- INT -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_IntCheck"
                            value="/roll @{check_roll} + @{int_mod}">
                        INT
                    </button>
                    <div class="ability-score">
                        <span name="attr_int_mod_display"></span>
                    </div>
                    <input type="number" name="attr_int_score" class="ability-score-input" />
                </div>

                <!-- WIS -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_WisCheck"
                            value="/roll @{check_roll} + @{wis_mod}">
                        WIS
                    </button>
                    <div class="ability-score">
                        <span name="attr_wis_mod_display"></span>
                    </div>
                    <input type="number" name="attr_wis_score" class="ability-score-input" />
                </div>

                <!-- CHA -->
                <div class="ability-box">
                    <button type="roll"
                            class="ability-title"
                            name="roll_ChaCheck"
                            value="/roll @{check_roll} + @{cha_mod}">
                        CHA
                    </button>
                    <div class="ability-score">
                        <span name="attr_cha_mod_display"></span>
                    </div>
                    <input type="number" name="attr_cha_score" class="ability-score-input" />
                </div>

            </div>
        </div>

        <!-- ===== PAGE CONTENT ===== -->
        <div class="page page-core">
            <!-- ==================== SKILLS SECTION ==================== -->
            <div class="skills-section">
                <div class="skill-top">
                    <label class="skill-top-label">Skills</label>
                </div>
                
                <div class="skill-info">
                    <span class="skill-header">Prof</span>
                    <span class="skill-header">Name</span>
                    <span class="skill-header">Abi</span>
                    <span class="skill-header">Mod</span>
                    <span class="skill-header">Sum</span>
                </div>

                <div class="skills-list">
                    <!-- Acrobatics -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_acrobatics_prof" value="0" checked />
                            <input type="radio" name="attr_skill_acrobatics_prof" value="1" />
                            <input type="radio" name="attr_skill_acrobatics_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_acrobatics"
                                value="/roll @{check_roll} + @{skill_acrobatics_sum_display}">
                            Acrobatics
                        </button>
                        <select name="attr_skill_acrobatics_ability" class="skill-ability">
                            <option value="dex" selected>DEX</option>
                            <option value="str">STR</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_acrobatics_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_acrobatics_sum_display">+0</span>
                    </div>

                    <!-- Animal Handling -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_animal_handling_prof" value="0" checked />
                            <input type="radio" name="attr_skill_animal_handling_prof" value="1" />
                            <input type="radio" name="attr_skill_animal_handling_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_animal_handling"
                                value="/roll @{check_roll} + @{skill_animal_handling_sum_display}">
                            Animal Handling
                        </button>
                        <select name="attr_skill_animal_handling_ability" class="skill-ability">
                            <option value="wis" selected>WIS</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_animal_handling_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_animal_handling_sum_display">+0</span>
                    </div>

                    <!-- Arcana -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_arcana_prof" value="0" checked />
                            <input type="radio" name="attr_skill_arcana_prof" value="1" />
                            <input type="radio" name="attr_skill_arcana_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_arcana"
                                value="/roll @{check_roll} + @{skill_arcana_sum_display}">
                            Arcana
                        </button>
                        <select name="attr_skill_arcana_ability" class="skill-ability">
                            <option value="int" selected>INT</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_arcana_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_arcana_sum_display">+0</span>
                    </div>

                    <!-- Athletics -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_athletics_prof" value="0" checked />
                            <input type="radio" name="attr_skill_athletics_prof" value="1" />
                            <input type="radio" name="attr_skill_athletics_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_athletics"
                                value="/roll @{check_roll} + @{skill_athletics_sum_display}">
                            Athletics
                        </button>
                        <select name="attr_skill_athletics_ability" class="skill-ability">
                            <option value="str" selected>STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_athletics_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_athletics_sum_display">+0</span>
                    </div>

                    <!-- Deception -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_deception_prof" value="0" checked />
                            <input type="radio" name="attr_skill_deception_prof" value="1" />
                            <input type="radio" name="attr_skill_deception_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_deception"
                                value="/roll @{check_roll} + @{skill_deception_sum_display}">
                            Deception
                        </button>
                        <select name="attr_skill_deception_ability" class="skill-ability">
                            <option value="cha" selected>CHA</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                        </select>
                        <input type="number" name="attr_skill_deception_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_deception_sum_display">+0</span>
                    </div>

                    <!-- History -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_history_prof" value="0" checked />
                            <input type="radio" name="attr_skill_history_prof" value="1" />
                            <input type="radio" name="attr_skill_history_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_history"
                                value="/roll @{check_roll} + @{skill_history_sum_display}">
                            History
                        </button>
                        <select name="attr_skill_history_ability" class="skill-ability">
                            <option value="int" selected>INT</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_history_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_history_sum_display">+0</span>
                    </div>

                    <!-- Insight -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_insight_prof" value="0" checked />
                            <input type="radio" name="attr_skill_insight_prof" value="1" />
                            <input type="radio" name="attr_skill_insight_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_insight"
                                value="/roll @{check_roll} + @{skill_insight_sum_display}">
                            Insight
                        </button>
                        <select name="attr_skill_insight_ability" class="skill-ability">
                            <option value="wis" selected>WIS</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_insight_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_insight_sum_display">+0</span>
                    </div>

                    <!-- Intimidation -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_intimidation_prof" value="0" checked />
                            <input type="radio" name="attr_skill_intimidation_prof" value="1" />
                            <input type="radio" name="attr_skill_intimidation_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_intimidation"
                                value="/roll @{check_roll} + @{skill_intimidation_sum_display}">
                            Intimidation
                        </button>
                        <select name="attr_skill_intimidation_ability" class="skill-ability">
                            <option value="cha" selected>CHA</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                        </select>
                        <input type="number" name="attr_skill_intimidation_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_intimidation_sum_display">+0</span>
                    </div>

                    <!-- Investigation -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_investigation_prof" value="0" checked />
                            <input type="radio" name="attr_skill_investigation_prof" value="1" />
                            <input type="radio" name="attr_skill_investigation_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_investigation"
                                value="/roll @{check_roll} + @{skill_investigation_sum_display}">
                            Investigation
                        </button>
                        <select name="attr_skill_investigation_ability" class="skill-ability">
                            <option value="int" selected>INT</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_investigation_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_investigation_sum_display">+0</span>
                    </div>

                    <!-- Medicine -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_medicine_prof" value="0" checked />
                            <input type="radio" name="attr_skill_medicine_prof" value="1" />
                            <input type="radio" name="attr_skill_medicine_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_medicine"
                                value="/roll @{check_roll} + @{skill_medicine_sum_display}">
                            Medicine
                        </button>
                        <select name="attr_skill_medicine_ability" class="skill-ability">
                            <option value="wis" selected>WIS</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_medicine_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_medicine_sum_display">+0</span>
                    </div>

                    <!-- Nature -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_nature_prof" value="0" checked />
                            <input type="radio" name="attr_skill_nature_prof" value="1" />
                            <input type="radio" name="attr_skill_nature_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_nature"
                                value="/roll @{check_roll} + @{skill_nature_sum_display}">
                            Nature
                        </button>
                        <select name="attr_skill_nature_ability" class="skill-ability">
                            <option value="int" selected>INT</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_nature_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_nature_sum_display">+0</span>
                    </div>

                    <!-- Perception -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_perception_prof" value="0" checked />
                            <input type="radio" name="attr_skill_perception_prof" value="1" />
                            <input type="radio" name="attr_skill_perception_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_perception"
                                value="/roll @{check_roll} + @{skill_perception_sum_display}">
                            Perception
                        </button>
                        <select name="attr_skill_perception_ability" class="skill-ability">
                            <option value="wis" selected>WIS</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_perception_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_perception_sum_display">+0</span>
                    </div>

                    <!-- Performance -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_performance_prof" value="0" checked />
                            <input type="radio" name="attr_skill_performance_prof" value="1" />
                            <input type="radio" name="attr_skill_performance_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_performance"
                                value="/roll @{check_roll} + @{skill_performance_sum_display}">
                            Performance
                        </button>
                        <select name="attr_skill_performance_ability" class="skill-ability">
                            <option value="cha" selected>CHA</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                        </select>
                        <input type="number" name="attr_skill_performance_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_performance_sum_display">+0</span>
                    </div>

                    <!-- Persuasion -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_persuasion_prof" value="0" checked />
                            <input type="radio" name="attr_skill_persuasion_prof" value="1" />
                            <input type="radio" name="attr_skill_persuasion_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_persuasion"
                                value="/roll @{check_roll} + @{skill_persuasion_sum_display}">
                            Persuasion
                        </button>
                        <select name="attr_skill_persuasion_ability" class="skill-ability">
                            <option value="cha" selected>CHA</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                        </select>
                        <input type="number" name="attr_skill_persuasion_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_persuasion_sum_display">+0</span>
                    </div>

                    <!-- Religion -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_religion_prof" value="0" checked />
                            <input type="radio" name="attr_skill_religion_prof" value="1" />
                            <input type="radio" name="attr_skill_religion_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_religion"
                                value="/roll @{check_roll} + @{skill_religion_sum_display}">
                            Religion
                        </button>
                        <select name="attr_skill_religion_ability" class="skill-ability">
                            <option value="int" selected>INT</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_religion_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_religion_sum_display">+0</span>
                    </div>

                    <!-- Sleight of Hand -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_sleight_of_hand_prof" value="0" checked />
                            <input type="radio" name="attr_skill_sleight_of_hand_prof" value="1" />
                            <input type="radio" name="attr_skill_sleight_of_hand_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_sleight_of_hand"
                                value="/roll @{check_roll} + @{skill_sleight_of_hand_sum_display}">
                            Sleight of Hand
                        </button>
                        <select name="attr_skill_sleight_of_hand_ability" class="skill-ability">
                            <option value="dex" selected>DEX</option>
                            <option value="str">STR</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_sleight_of_hand_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_sleight_of_hand_sum_display">+0</span>
                    </div>

                    <!-- Stealth -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_stealth_prof" value="0" checked />
                            <input type="radio" name="attr_skill_stealth_prof" value="1" />
                            <input type="radio" name="attr_skill_stealth_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_stealth"
                                value="/roll @{check_roll} + @{skill_stealth_sum_display}">
                            Stealth
                        </button>
                        <select name="attr_skill_stealth_ability" class="skill-ability">
                            <option value="dex" selected>DEX</option>
                            <option value="str">STR</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="wis">WIS</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_stealth_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_stealth_sum_display">+0</span>
                    </div>

                    <!-- Survival -->
                    <div class="skill-row">
                        <div class="skill-prof-radio">
                            <input type="radio" name="attr_skill_survival_prof" value="0" checked />
                            <input type="radio" name="attr_skill_survival_prof" value="1" />
                            <input type="radio" name="attr_skill_survival_prof" value="2" />
                        </div>
                        <button type="roll" 
                                class="skill-name" 
                                name="roll_skill_survival"
                                value="/roll @{check_roll} + @{skill_survival_sum_display}">
                            Survival
                        </button>
                        <select name="attr_skill_survival_ability" class="skill-ability">
                            <option value="wis" selected>WIS</option>
                            <option value="str">STR</option>
                            <option value="dex">DEX</option>
                            <option value="con">CON</option>
                            <option value="int">INT</option>
                            <option value="cha">CHA</option>
                        </select>
                        <input type="number" name="attr_skill_survival_mod" class="skill-mod" value="0" />
                        <span class="skill-sum" name="attr_skill_survival_sum_display">+0</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="page page-combat">Combat left content</div>
        <div class="page page-inventory">Inventory left content</div>
        <div class="page page-spells">Spells left content</div>
        <div class="page page-bio">Bio left content</div>

    </div>

    <!-- ==================== RIGHT COLUMN (60%) ==================== -->
    <div class="sheet-right">

        <!-- ===== STATIC TOP CONTROLS ===== -->
        <div class="static-right-top">

            <!-- Proficiency Bonus -->
            <div class="proficiency-box">
                <span class="prof-label">Proficiency Bonus</span>
                <span class="prof-value" name="attr_prof_bonus_display">+3</span>
            </div>

            <!-- Advantage / Disadvantage -->
            <div class="adv-dis-box">
                <button type="action" name="act_toggle_adv" class="adv-btn">Advantage</button>
                <span class="adv-slash">/</span>
                <button type="action" name="act_toggle_dis" class="dis-btn">Disadvantage</button>
            </div>

        </div>

        <!-- ===== PAGE CONTENT ===== -->
        <div class="page page-core">
            <div class="character-info-row">
                <div class="info-field">
                    <label class="info-label">Race</label>
                    <input type="text" name="attr_race" class="info-input" />
                </div>
                <div class="info-field">
                    <label class="info-label">Subrace</label>
                    <input type="text" name="attr_subrace" class="info-input" />
                </div>
                <div class="info-field">
                    <label class="info-label">Alignment</label>
                    <input type="text" name="attr_alignment" class="info-input" list="alignment-list" />
                    <datalist id="alignment-list">
                        <option value="Lawful Good">
                        <option value="Lawful Neutral">
                        <option value="Lawful Evil">
                        <option value="Neutral Good">
                        <option value="True Neutral">
                        <option value="Neutral Evil">
                        <option value="Chaotic Good">
                        <option value="Chaotic Neutral">
                        <option value="Chaotic Evil">
                </div>
            </div>
            <div class="character-levels-box">
                <fieldset class="repeating_levels">
                    <div class="level-entry">
                        <input type="text" name="attr_class" class="level-input" placeholder="Class" />
                        <input type="text" name="attr_subclass" class="level-input" placeholder="Subclass" />
                        <input type="number" name="attr_level" class="level-input level-number" placeholder="Level" min="0" value="1" />
                    </div>
                </fieldset>
                    <div class="levels-bottom">
                        <!-- EXP Tracker -->
                        <div class="exp-tracker">
                            <label class="exp-label">Experience</label>
                            <div class="exp-inputs-wrapper">
                                <input type="number" name="attr_exp_current" class="exp-input" placeholder="Current" />
                                <span class="exp-slash">/</span>
                                <input type="number" name="attr_exp_next" class="exp-input" list="exp-levels" placeholder="To next Level" />
                            </div>

                            <datalist id="exp-levels">
                                <option value="0" label="Level 1: 0 XP">
                                <option value="300" label="Level 2: 300 XP">
                                <option value="900" label="Level 3: 900 XP">
                                <option value="2700" label="Level 4: 2,700 XP">
                                <option value="6500" label="Level 5: 6,500 XP">
                                <option value="14000" label="Level 6: 14,000 XP">
                                <option value="23000" label="Level 7: 23,000 XP">
                                <option value="34000" label="Level 8: 34,000 XP">
                                <option value="48000" label="Level 9: 48,000 XP">
                                <option value="64000" label="Level 10: 64,000 XP">
                                <option value="85000" label="Level 11: 85,000 XP">
                                <option value="100000" label="Level 12: 100,000 XP">
                                <option value="120000" label="Level 13: 120,000 XP">
                                <option value="140000" label="Level 14: 140,000 XP">
                                <option value="165000" label="Level 15: 165,000 XP">
                                <option value="195000" label="Level 16: 195,000 XP">
                                <option value="225000" label="Level 17: 225,000 XP">
                                <option value="265000" label="Level 18: 265,000 XP">
                                <option value="305000" label="Level 19: 305,000 XP">
                                <option value="355000" label="Level 20: 355,000 XP">
                            </datalist>
                        </div> 
                    
                        <!-- Character Level Total -->
                        <div class="character-level-total">
                            <label class="total-label">Character Level</label>
                            <span class="total-value" name="attr_character_level">0</span>
                        </div>
                    </div>

            </div>
        </div>
        <div class="page page-combat">Combat content</div>
        <div class="page page-inventory">Inventory content</div>
        <div class="page page-spells">Spells content</div>
        <div class="page page-bio">Bio content</div>

    </div>
</div>

<!-- ==================== SHEET WORKER ==================== -->
<script type="text/worker">

    /* ==================== PAGE SWITCHING ==================== */
    on("clicked:core", () => setAttrs({ current_page: "core" }));
    on("clicked:combat", () => setAttrs({ current_page: "combat" }));
    on("clicked:inventory", () => setAttrs({ current_page: "inventory" }));
    on("clicked:spells", () => setAttrs({ current_page: "spells" }));
    on("clicked:bio", () => setAttrs({ current_page: "bio" }));

    /* ==================== ADV / DIS LOGIC ==================== */
    const rollForState = (state) => {
        if (state === "adv") return "2d20kh1";
        if (state === "dis") return "2d20kl1";
        return "1d20";
    };
    
    on("clicked:toggle_adv", () => {
        getAttrs(["adv_state"], v => {
            const current = v.adv_state || "none";
            const next = current === "adv" ? "none" : "adv";
            setAttrs({
                adv_state: next,
                check_roll: rollForState(next)
            });
        });
    });
    
    on("clicked:toggle_dis", () => {
        getAttrs(["adv_state"], v => {
            const current = v.adv_state || "none";
            const next = current === "dis" ? "none" : "dis";
            setAttrs({
                adv_state: next,
                check_roll: rollForState(next)
            });
        });
    });

    /* ==================== ABILITY MODIFIERS ==================== */
    const abilities = ["str","dex","con","int","wis","cha"];

    const calcMod = (score) => {
        const s = parseInt(score,10);
        if (isNaN(s)) return 0;
        return Math.floor((s - 10) / 2);
    };

    const format = (m) => (m >= 0 ? "+" : "") + m;

    on("sheet:opened", () => {
        const attrs = [];
        abilities.forEach(a => {
            attrs.push(`${a}_score`, `${a}_mod`, `${a}_mod_display`);
        });

        getAttrs(attrs, v => {
            const out = {};
            abilities.forEach(a => {
                const score = v[`${a}_score`] || 10;
                const mod = calcMod(score);
                out[`${a}_score`] = score;
                out[`${a}_mod`] = mod;
                out[`${a}_mod_display`] = format(mod);
            });
            setAttrs(out);
        });
    });

    abilities.forEach(a => {
        on(`change:${a}_score`, () => {
            getAttrs([`${a}_score`], v => {
                const mod = calcMod(v[`${a}_score`]);
                setAttrs({
                    [`${a}_mod`]: mod,
                    [`${a}_mod_display`]: format(mod)
                });
            });
        });
    });

    /* ==================== ALIGNMENT DROPDOWN ==================== */
    const alignments = [
        "Lawful Good",
        "Lawful Neutral", 
        "Lawful Evil",
        "Neutral Good",
        "True Neutral",
        "Neutral Evil",
        "Chaotic Good",
        "Chaotic Neutral",
        "Chaotic Evil"
    ];

    // Handle alignment dropdown clicks
    on("clicked:alignment_option", (eventInfo) => {
        const value = eventInfo.htmlAttributes["data-value"];
        if (value) {
            setAttrs({ alignment: value });
        }
    });

    /* ==================== PROFICIENCY BONUS CALCULATION ==================== */
    const calculateProficiencyBonus = (characterLevel) => {
        if (characterLevel <= 0) {
            return { prof_bonus: 0, prof_bonus_display: "+0" };
        }
        
        // D&D 5e proficiency bonus: +2 at levels 1-4, increases by +1 every 4 levels
        // Formula: floor((level - 1) / 4) + 2
        const bonus = Math.floor((characterLevel - 1) / 4) + 2;
        const display = (bonus >= 0 ? "+" : "") + bonus;
        
        return { prof_bonus: bonus, prof_bonus_display: display };
    };
    
    /* ==================== CHARACTER LEVEL CALCULATION ==================== */
    const calculateCharacterLevel = () => {
        getSectionIDs("repeating_levels", ids => {
            if (ids.length === 0) {
                setAttrs({ 
                    character_level: 0,
                    ...calculateProficiencyBonus(0)
                });
                return;
            }
            
            const attrs = ids.map(id => `repeating_levels_${id}_level`);
            getAttrs(attrs, v => {
                let total = 0;
                ids.forEach(id => {
                    const levelValue = v[`repeating_levels_${id}_level`];
                    // Only process if the attribute exists and has been set (not empty/undefined)
                    if (levelValue !== undefined && levelValue !== "" && levelValue !== null) {
                        const level = parseInt(levelValue, 10);
                        if (!isNaN(level) && level > 0) {
                            total += level;
                        }
                    }
                });
                
                const profBonus = calculateProficiencyBonus(total);
                setAttrs({ 
                    character_level: total,
                    ...profBonus
                });
            });
        });
    };
    
    // Calculate on sheet open
    on("sheet:opened", () => {
        calculateCharacterLevel();
    });
    
    // Calculate when level values
    on("change:repeating_levels", () => {
        calculateCharacterLevel();
    });
    
    // Calculate when items are removed
    on("remove:repeating_levels", () => {
        calculateCharacterLevel();
    });

    /* ==================== SKILLS CALCULATION ==================== */
    const skillData = [
        { name: "acrobatics", ability: "dex" },
        { name: "animal_handling", ability: "wis" },
        { name: "arcana", ability: "int" },
        { name: "athletics", ability: "str" },
        { name: "deception", ability: "cha" },
        { name: "history", ability: "int" },
        { name: "insight", ability: "wis" },
        { name: "intimidation", ability: "cha" },
        { name: "investigation", ability: "int" },
        { name: "medicine", ability: "wis" },
        { name: "nature", ability: "int" },
        { name: "perception", ability: "wis" },
        { name: "performance", ability: "cha" },
        { name: "persuasion", ability: "cha" },
        { name: "religion", ability: "int" },
        { name: "sleight_of_hand", ability: "dex" },
        { name: "stealth", ability: "dex" },
        { name: "survival", ability: "wis" }
    ];

    const calculateSkillSum = (prof, abilityMod, profBonus, mod) => {
        const profValue = parseInt(prof, 10) || 0;
        const ability = parseInt(abilityMod, 10) || 0;
        const profB = parseInt(profBonus, 10) || 0;
        const modifier = parseInt(mod, 10) || 0;
        
        let profMultiplier = 0;
        if (profValue === 1) profMultiplier = 1;      // Proficiency
        if (profValue === 2) profMultiplier = 2;      // Expertise
        
        const total = ability + (profB * profMultiplier) + modifier;
        return total;
    };

    const formatSkillSum = (sum) => {
        return (sum >= 0 ? "+" : "") + sum;
    };

    const calculateAllSkills = () => {
        getAttrs(["prof_bonus"], v => {
            const profBonus = v.prof_bonus || 0;
            const attrs = [];
            
            skillData.forEach(skill => {
                attrs.push(
                    `skill_${skill.name}_prof`,
                    `skill_${skill.name}_ability`,
                    `skill_${skill.name}_mod`
                );
            });
            
            getAttrs(attrs, skillV => {
                const updates = {};
                
                skillData.forEach(skill => {
                    const prof = skillV[`skill_${skill.name}_prof`] || "0";
                    const abilityName = skillV[`skill_${skill.name}_ability`] || skill.ability;
                    const mod = skillV[`skill_${skill.name}_mod`] || "0";
                    
                    getAttrs([`${abilityName}_mod`], abilityV => {
                        const abilityMod = abilityV[`${abilityName}_mod`] || 0;
                        const sum = calculateSkillSum(prof, abilityMod, profBonus, mod);
                        
                        updates[`skill_${skill.name}_sum`] = sum;
                        updates[`skill_${skill.name}_sum_display`] = formatSkillSum(sum);
                    });
                });
                
                setAttrs(updates);
            });
        });
    };

    // Calculate skills when any skill attribute changes
    skillData.forEach(skill => {
        on(`change:skill_${skill.name}_prof change:skill_${skill.name}_ability change:skill_${skill.name}_mod`, () => {
            calculateAllSkills();
        });
    });

    // Recalculate when ability modifiers change
    abilities.forEach(ability => {
        on(`change:${ability}_mod`, () => {
            calculateAllSkills();
        });
    });

    // Recalculate when proficiency bonus changes
    on("change:prof_bonus", () => {
        calculateAllSkills();
    });

    // Calculate on sheet open
    on("sheet:opened", () => {
        calculateAllSkills();
    });
</script>
